# Prometheus Configuration for Echo Services
# Scrapes metrics from all backend services and infrastructure components

global:
  scrape_interval: 15s # How often to scrape targets
  evaluation_interval: 15s # How often to evaluate rules
  scrape_timeout: 10s # Timeout for scrape requests

  # Attach these labels to all metrics scraped by this Prometheus instance
  external_labels:
    monitor: "echo-monitor"
    environment: "development"

# Alertmanager configuration (optional, for future alerting)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Rule files (for recording rules and alerts)
# rule_files:
#   - /etc/prometheus/rules/*.yml

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"

  # OpenTelemetry Collector metrics
  - job_name: "otel-collector"
    static_configs:
      - targets: ["otel-collector:8888"]
        labels:
          service: "otel-collector"

  # User Service
  - job_name: "user-service"
    static_configs:
      - targets: ["user-service:8001"]
        labels:
          service: "user-service"
    metrics_path: /metrics
    scrape_interval: 15s

  # Workspace-Channel Service
  - job_name: "workspace-channel-service"
    static_configs:
      - targets: ["workspace-channel-service:8002"]
        labels:
          service: "workspace-channel-service"
    metrics_path: /metrics
    scrape_interval: 15s

  # Message Service
  - job_name: "message-service"
    static_configs:
      - targets: ["message-service:8003"]
        labels:
          service: "message-service"
    metrics_path: /metrics
    scrape_interval: 15s

  # BFF Service
  - job_name: "bff-service"
    static_configs:
      - targets: ["bff-service:8080"]
        labels:
          service: "bff-service"
    metrics_path: /metrics
    scrape_interval: 15s

  # Notification Service
  - job_name: "notification-service"
    static_configs:
      - targets: ["notification-service:8005"]
        labels:
          service: "notification-service"
    metrics_path: /metrics
    scrape_interval: 15s

  # Redis metrics (if redis_exporter is added later)
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #       labels:
  #         service: 'redis'

  # RabbitMQ metrics (built-in Prometheus endpoint)
  - job_name: "rabbitmq"
    static_configs:
      - targets: ["rabbitmq:15692"]
        labels:
          service: "rabbitmq"
    metrics_path: /metrics
    scrape_interval: 30s
